---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
import { Sun, Moon } from 'lucide-astro';
---

<header>
	<nav>
		
		<div class="internal-links">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/about">About</HeaderLink>
		</div>
		<div class="header-actions">
			<button class="theme-toggle" id="theme-toggle" type="button" aria-pressed="false">
				<Sun class="theme-toggle__icon icon-sun" aria-hidden="true" />
				<Moon class="theme-toggle__icon icon-moon" aria-hidden="true" />
				<span class="sr-only">Toggle dark mode</span>
			</button>
		</div>
	</nav>
</header>
<script is:inline>
	(() => {
		const storageKey = 'theme';
		const toggle = document.getElementById('theme-toggle');
		const getTheme = () => {
			const stored = localStorage.getItem(storageKey);
			if (stored === 'dark' || stored === 'light') return stored;
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
		};
		const setTheme = (theme) => {
			document.documentElement.dataset.theme = theme;
			document.documentElement.style.colorScheme = theme;
			localStorage.setItem(storageKey, theme);
			if (toggle) {
				toggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
			}
		};
		const syncToggle = () => {
			const theme = document.documentElement.dataset.theme || getTheme();
			if (toggle) {
				toggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
			}
		};
		syncToggle();
		toggle?.addEventListener('click', () => {
			const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
			setTheme(next);
		});
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
			if (!localStorage.getItem(storageKey)) {
				setTheme(event.matches ? 'dark' : 'light');
			}
		});
	})();
</script>
<style>
	header {
		margin-bottom: 5px;
		padding: 0 1em;
		
	}
	h2 {
		margin: 0;
		font-size: 1em;
	}

	h2 a,
	h2 a.active {
		text-decoration: none;
	}
	nav {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.internal-links {
		display: flex;
		gap: 0.5rem;
	}
	nav a {
		padding: 1em 0.5em;
		color: var(--black);
		border-bottom: 4px solid transparent;
		text-decoration: none;
	}
	nav a.active {
		text-decoration: none;
		border-bottom-color: var(--accent);
	}
	.header-actions {
		position: absolute;
		right: 0;
		display: flex;
		align-items: center;
		gap: 0.5em;
	}
	.theme-toggle {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 36px;
		height: 36px;
		border-radius: 999px;
		border: 1px solid var(--border);
		background: transparent;
		color: rgb(var(--black));
		cursor: pointer;
		transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
	}
	.theme-toggle:hover {
		background: rgba(var(--gray), 10%);
		border-color: rgba(var(--gray), 40%);
	}
	.theme-toggle:active {
		transform: scale(0.97);
	}
	.theme-toggle__icon {
		width: 18px;
		height: 18px;
	}
	.icon-sun {
		display: none;
	}
	html[data-theme='dark'] .icon-sun {
		display: block;
	}
	html[data-theme='dark'] .icon-moon {
		display: none;
	}
</style>
